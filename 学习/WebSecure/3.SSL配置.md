# apache 配置 SSL

### 大致思路

1. openssl创建密钥对作为服务器密钥
2. openssl创建密钥对作为自建CA密钥
3. 自建CA为服务器颁发证书

### 操作步骤

1. 配置apache
2. 安装openssl 
    ```
    sudo apt install openssl
    ```
3. 开启ssl模块
    ```
    sudo a2enmod ssl
    ```
4.  创建证书
    ```bash
    sudo openssl
    OpenSSL> req -x509 -newkey rsa:1024 -keyout apache.pem -out apache.pem -nodes -days 999
        Generating a RSA private key
        ..........................................+++++
        ....................+++++
        writing new private key to 'apache.pem'
        -----
        You are about to be asked to enter information that will be incorporated
        into your certificate request.
        What you are about to enter is what is called a Distinguished Name or a DN.
        There are quite a few fields but you can leave some blank
        For some fields there will be a default value,
        If you enter '.', the field will be left blank.
        -----
        Country Name (2 letter code) [AU]:CN
        State or Province Name (full name) [Some-State]:JS
        Locality Name (eg, city) []:SZ
        Organization Name (eg, company) [Internet Widgits Pty Ltd]:USTCSSE
        Organizational Unit Name (eg, section) []:SSE
        Common Name (e.g. server FQDN or YOUR name) []:LZW
        Email Address []:test@edu.com
    ```
    此时在当前目录会生成apache.pem文件,已经包含了密钥和证书  
    可以将这个文件拷贝到/etc/apache2/目录新创建的ssl目录下
    ```
    sudo mkdir /etc/apache2/ssl          
    sudo cp apache.pem /etc/apache2/ssl/
    ```
5. 由第三方CA机构签署证书  
    生成此证书，需要向第三方提交一个“生成证书请求文件(CSR)”，生成这个CSR需要两步：
    - 生成私钥KEY
    - 生成请求CSR
   1. 运行如下命令生成私钥
    ```
    OpenSSL> genrsa	-out server.key
    ```
   2. 运行如下命令生成CSR
    ```
    OpenSSL> genrsa	1024 -out server.key
    ```
6. 