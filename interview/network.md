# 计算机网络

### 概述

1. OSI七层结构及其相应功能  
    | OSI七层协议 |               功能               |                    TCP/IP协议族                    |
    | :---------: | :------------------------------: | :------------------------------------------------: |
    |   应用层    |     文件服务、邮件、虚拟终端     |         TFTP\HTTP\SNMP\FTP\SMTP\DNS\Telent         |
    |   会话层    |  数据格式化、代码转换、数据加密  |                      没有协议                      |
    |   表示层    |       建立与其他站点的联系       |                      没有协议                      |
    |   传输层    |         提供端对端的接口         |                      TCP/UDP                       |
    |   网络层    |         为数据包选择路由         |             IP/ICMP/RIP/OSPF/BGP/IGMP              |
    | 数据链路层  |   传输有地址的帧、差错检测功能   | CSLIP/PPP/ARP/MTU/IEEE803.3(基带总线型)/IEEE802.11 |
    |   物理层    | 以二进制形式在物理媒体上传输数据 |             ISO2110/IEEE802/IEEE802.2              |
2. 交换机是几层设备  
    |  TCP/IP层  |                        网络设备                        |     域     |
    | :--------: | :----------------------------------------------------: | :--------: |
    |   传输层   |              网关、四层交换机、四层路由器              |
    |   网络层   |                   路由器、三层交换机                   |
    | 数据链路层 | 网桥、以太网交换机(多端口网桥)、网卡(半物理半数据链路) | 隔离冲突域 |
    |   物理层   |           中继器(转发器)、集线器Hub、双绞线            |

### 数据链路层

1. 链路管理  
    1. 通过MAC访问主机
    2. 透明传输(无论什么比特组合都能传输)-字符计数法、字符填充首位定界、比特填充首位标志
    3. 以太网帧的MTU为1500字节.
2. 差错控制
   1. 检错编码
      1. 奇偶校验码(1的个数)
      2. 循环冗余码
   2. 纠错编码
      1. 海明码(能发现双比特错,能纠正单比特错)
3. 流量控制和可靠传输机制
   1. 流量控制是对链路上的帧发送速率的控制，使接受方有足够的缓冲空间来接受每一个帧.
   2. 停止-等待协议:接受方要反馈应答信号
   3. 滑动窗口协议
   4. 停止等待协议、后退n帧协议、选择重传协议只是在发送窗口和接受窗口的大小上有差别(1-1、n-1、n-n)
   5. 可靠传输通常使用`确认`和`超时重传`两种机制来完成
   6. 自动重传请求(ARQ):停等式ARQ、后退N帧ARQ、选择性重传ARQ
4. 介质访问控制
   1. 信道划分:时分复用等
   2. 随机访问:Aloha协议、载波侦听多路访问(1非p-CSMA)、CSMA/CD协议(检测冲突,无法避免)
   3. 轮询访问
5. 协议
   1. PPP协议:串行面向字节无差错接收不可靠
   2. 高级链路控制协议(HDLC):面向比特无差错可靠

## 网络层

### 知识体系

1. 网络层功能
   1. 异构网络互联
   2. 路由转发
      1. 路由选择(路由表)
      2. 分组转发
   3. 拥塞控制
2. 路由算法
   1. 静态路由与动态路由
   2. 距离-向量算法
      1. 所有结点定期将它们整个路由选择表传送给所有与之直接相邻的结点,路由表包括目的地和代价.
      2. 在下列情况下更新路由表1.被通告一条新的路由2.收到的路由信息有更小代价.
      3. 常见的距离-向量算法:RIP.
   3. 链路状态路由算法
      1. 每个参与算法的结点都有完全的网络拓扑信息
      2. 主要任务1.主动测试所有相邻结点状态2.定期将链路状态传播给所有其他相邻结点.3.利用Dijsktra求最短路径
      3. 特征1.洪泛法向所有路由器发送信息2.发送链路状态3.只有链路状态发生变化时才发送
      4. 典型的链路状态路由算法:OSPF.
   4. 层次路由
      内部网关协议:RIP、OSPF
      外部网关协议:BGP
3. IPv4
   1. IPv4与NAT  
      首部由20字节固定长度加上可选字段构成.
      IP数据报最大长度为65535字节.而以太网帧MTU为1500字节.封装成帧时需要分片,片在目的地网络层重新组装.  
      NAT(网络地址转换)(传输层)通过将专用网络地址转换为公用地址,从而隐藏内部IP.让整个专用网只需要一个全球IP地址就可以与互联网联通.通过NAT转换表.
   2. 子网划分与子网掩码
   3. CIDR(网络前缀)
   4. 路由聚集(超网)
4. 路由协议
   1. 分组转发算法
      1. 从数据报的首部提取目的主机IP地址D,得出目的网络地址N
      2. 若网络N与路由器直接相连,则把数据报直接交付主机D
      3. 若路由器中有主机D的特定主机路由,则把数据报交给下一跳路由器(将下一跳的IP地址转换为MAC地址,修改MAC帧首部)
      4. 若有默认路由交默认路由
      5. 以上全无报告出错
   2. ARP协议  
      当主机A欲向本局域网上的某个主机B发送IP数据报时,就先在其ARP的高速缓存中查看有无主机B的IP地址.如果有就可以查出对应的硬件地址,再将此地址写入MAC帧发送.如果没有就封装目的地址为FF的帧来封装并*广播*ARP请求分组.主机B收到请求分组后向A*单播*发出响应ARP分组,分组中包含主机B的IP:MAC对应关系.主机A写入缓存并发送MAC帧.
   3. ICMP协议  
      网际控制报文协议分为ICMP差错报告报文和ICMP询问报文.ICMP差错报文有5种:终点不可达、源点抑制(traceroute)、时间超过、参数问题、改变路由.ICMP询问报文有四种:回送请求和回答报文(PING)、时间戳请求和回答报文、掩码地址请求和回答报文、路由器询问和通告报文。
   4. 自治系统
   5. 域内路由与域间路由
   6. RIP路由协议  
      路由信息协议基于路由-向量算法.距离又称跳数,允许最长15跳,防止数据报循环在环路上.每30s广播一次RIP路由更新信息.
   7. OSPF路由协议  
      开放最短路径优先协议是使用分布式链路状态路由算法的典型代表.如果同一个网络有多条相同代价的路径可以将通信量分配给这几条路径.
      |          |      RIP       |           OSPF           |
      | :------: | :------------: | :----------------------: |
      | 发送信息 |   整个路由表   | 与本路由器相邻的链路状态 |
      | 发送目标 |   相邻路由器   |          洪泛法          |
      | 协议位置 | 应用层,基于UDP |      网络层IP数据报      |
   8. BGP路由协议  
      边界网关协议采用路径向量路由选择协议,是应用层协议,基于TCP.

### 问题

1. 网络层的路由算法有哪些,简述RIP\OSRF过程
2. 简述ARP协议过程,是如何通过IP地址获取MAC地址的
3. ping命令所使用的协议是什么(ICMP)简述其过程

## 传输层

### 知识体系

1. 传输层提供的服务
   1. 功能  
      提供进程之间的通信(端到端),复用分用,传输层对收到的首部和数据进行差错检测,提供有连接和无连接两种不同传输协议.
   2. 传输层寻址与端口  
      熟知端口号:21FTP。23TELENT、25SMTP、53DNS、69TFTP、80HTTP、161SNMP
   3. 无连接服务和面向连接服务
2. UDP协议  
   UDP协议无需建立连接,无连接状态,分组首部开销小,没有拥塞控制(可以保证实时,不能保证丢包),只有复用分用和差错检测(校验和).常用一次性传输少量数据的网络应用.报文是UDP数据报处理的最小单位.
3. TCP协议  
   特点:面向连接,一对一两个端点,无差错不丢失不重复有序,全双工,面向字节流.
   1. TCP段:首部20+4N
   2. TCP连接管理:三次握手
      1. 客户机向服务器发送连接请求报文段,不含应用层数据,SYN=1,seq=x(消耗掉一个序号).
      2. 服务器收到连接请求报文段后,同意连接会发回确认,并为该TCP连接分配TCP缓存和变量.SYN=1,ACK=1,seq=y(消耗掉一个序号).
      3. 客户机收到确认报文段后,还要向服务器发回确认,并给该连接分配缓存和变量.ACK=1,sql=x+1,ack=y+1,不携带数据不消耗序号.
   3. TCP连接管理:四次挥手
      1. 客户机打算关闭连接,就向其TCP发送一个连接释放报文段,停止发送数据,主动关闭TCP连接,FIN=1,seq=u(消耗掉一个序号)
      2. 服务器收到连接释放报文段后发出确认,ACK=1,ack=u+1,seq=v,此时TCP处于半关闭状态.服务器仍可向客户机发送数据.
      3. 服务器没有要发送的数据之后,通知TCP释放链接,FIN=1,ACK=1,seq=w,ack=u+1.
      4. 客户机收到连接释放报文段后,发出确认报文.ACK=1,ack=w+1,seq=u+1.等待时间计时器设置的2MSL后连接关闭.
   4. TCP可靠传输
      使用*校验*、*序号*、*确认*和*重传*等机制来达到这个目的.重传分为超时和冗余ACK
   5. TCP流量控制与拥塞控制
      TCP提供一种基于滑动窗口协议的流量控制机制.接受方根据自己接收缓存的大小维护一个接收窗口rwnd,发送方根据其对当前网络拥塞程度的估计而确定的拥塞窗口cwnd,发送窗口将取rwnd和cwnd的最小值.
   6. 拥塞控制  
      四种拥塞控制算法:慢开始、拥塞避免、快重传(冗余ACK)、快恢复.其中TCP Reno版本使用快恢复算法.

### 问题

8. TCP如何保证可靠传输
9.  TCP的流量控制,当接收方的接收窗口为0的时候怎么办
10. TCP的拥塞控制(慢启动、拥塞避免、超时间间隔传输及快重传、快恢复)
11. 流量控制和拥塞控制有什么区别  
      流量控制往往是指在发送端和接收端进行点对点通信量的控制.通过抑制发送端发送数据的速率,以便使接收端来得及接收.  
      拥塞控制是确保通信子网能够承载传送待传送的数据.这是一个全局性的问题,涉及网络中所有的主机、路由器、以及导致网络传输能力下降的所有因素.方法1开环控制2闭环控制(基于反馈环路).
1.  TCP的连接管理中可能出现的攻击漏洞（洪泛攻击等）
      服务器在第二次握手就分配了资源,而客户端在第三次握手才分配资源.
2.  TCP三次握手四次挥手
3.  socket通信

   |                      服务器                      |                客户端                |
   | :----------------------------------------------: | :----------------------------------: |
   |       socket(); //socket要求必须绑定socket       | socket(); //socket要求必须绑定socket |
   | bind(); //绑定端口和IP，这样我们才知道是那台主机 |        connect(); //请求连接         |
   |        listen(); //监听，看有没有请求连接        |
   |               accept(); //接收请求               |
   |          send();rev(); //接收和发送消息          |

## 应用层

### 知识体系

1. 协议
   1. DHCP协议:动态主机配置协议是应用层协议,基于UDP.步骤是客户端广播DHCP发现,服务器广播DHCP提供,客户端广播DHCP请求,服务器广播DHCP确认.

### 问题

1. 应用层有哪些常见协议
   FTP、IMAP、HTTP等
2. 用户点击链接后发生的过程
   1. 浏览器分析链接指向的URL
   2. 浏览器请求DNS解析
   3. 域名系统 DNS从域名中解析出IP地址
   4. 浏览器与该服务器建立TCP连接(默认端口号80)
   5. 浏览器发出HTTP请求 GET /index.html
   6. 服务器通过HTTP响应把文件发送给浏览器
   7. TCP连接释放
   8. 浏览器解释HTML文件并显示网页
3. HTTP1.0和1.1的区别:长连接,节约带宽,Host域
4. HTTP1.1和2.0的区别:多路复用,Head数据压缩,服务器推送
5. 状态码